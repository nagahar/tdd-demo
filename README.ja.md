# TDD 自動販売機

自動販売機を作成しながら、ペアプログラミングとテスト駆動開発の練習を行いましょう。

## Objectives - 学習の目的

この課題を通して、次のことを行います。

- テスト駆動開発を通して、ステートマシン(state machine) を作成する。
- コードを書く前にテストを書く練習をする。
- SEAT パターンを使ってテストを書く練習をする。
- 効果的なペアプログラミングの手法を練習する。

## User story - ユーザストーリー

- あなたは買い物客です。
- 自動販売機を使って、
- 商品を効率的に購入したいです。

## State - 状態

- balance - コインを入れたが、まだ使用していない金額（残高）
- till - 自動販売機内のコインと数の状態（マップ）
- selectedRow - 選択された行の情報
- selectedColumn - 選択された列の情報

## Behavior - 振る舞い

**以下は、実装すべきメソッドの提案にすぎません。おそらく、これらのメソッド以外の別のメソッドも作成した方がテストが容易になるでしょう。要確認：単一責任の原則、メソッドに 1 つのことだけを行わせるべきです。**

- `insertCoin(denomination)` - 自動販売機にコインを入れる
- `changeReturn()` - コンソールにコインのログを表示し、残高(balance) をリセットする
- `pressButton('A'-'D')` - 行を選択する
- `pressButton(1-4)` - 列を選択する

## Instructions - 説明

あなたのお気に入りの商品の商品名・金額・在庫数の情報を 4x4 の二次元配列として、自動販売機をモデル化しましょう。例：

```JavaScript
const juice = { name: "Apple Juice", price: 350, count: 5 };
const coffee = { name: "Starbucks", price: 250, count: 7 };

const inventory = [
  [juice, coffee, ..., ...],
  [..., ..., ..., ...],
  [..., ..., ..., ...],
  [..., ..., ..., ...],
]
```

ハッピーパス（一番シンプルなシナリオ）として、次の流れで進めていきましょう：

1. コインを挿入する
2. 行を選択する
3. 列を選択する
4. 商品を出す（コンソールにログを記録する）
5. 在庫を更新する
6. お釣りを出す

## 必要要件

1. 残高がゼロの場合、コインを投入すると残高を増やし、同時にコインの種類を保存する必要があります。
2. 行が選択されていない状態で行が選択されると、選択された行の文字を保存し、それをコンソールに出力する必要があります。
3. 行が選択されている状態で、列が選択され、対象の商品に十分な残高と在庫があれば...
   1. 選択された行と列をコンソールに出力する必要があります。
   2. "Here is your [item name]" というメッセージをログ出力する必要があります。
   3. そして、対象の商品の在庫を 1 つ減らす必要があります。
   4. 必要に応じてお釣りを返してください。（お釣りのコインの種類と数を、コンソールに出力する）
4. 行と列が選択されているが、選択された商品の在庫がない時、エラーメッセージをコンソールに出力する必要があります。
5. 行と列が選択されているが、選択された商品を購入するための残高が不足している時、エラーメッセージをコンソールに出力する必要があります。
6. プログラム起動直後の残高は 0 である必要があります。

**_注意してください：残高を計算してお釣りを返すには、コインの種類と数の両方を記憶しなければいけません_**

## アンハッピーパス（上記以外の留意点）

少なくとも、すべての必要要件に対してテストを実装しなければいけませんが、これらのテストのみに限定すべきではありません。必要なだけテストを書いてください。

優れた TDD 開発者として、仕様外のエッジケースを見つけた場合は、PM（インストラクター）に期待される機能を尋ねる必要があります。

## ペアプログラミング

この機会に、_ピンポンペアプログラミング_ を練習しましょう：

1. 左側のペアが、失敗するケースのテストを書きます。
1. 右側のペアが、テストをパスするための最小限のコードを書きます。
1. 右側のペアが、次のテストを書きます。
1. 左側のペアが、テストをパスするコードを書きます。

リファクタリングすることを忘れないでください。テストをパスした後にリファクタリングを行いましょう！

**_ヒント：コンソールにログ出力されたものをテストしようとせず、代わりにメソッドをどのように組み立てて、お釣りや出したアイテム（商品）などのオブジェクトをどのように戻り値として返すか、その方法を考えましょう。これにより、戻り値に対してのテストを作成できるようになります。_**

## セットアップ

```bash
npm i
npm test
```
